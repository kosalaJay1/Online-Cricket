<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>6-Digit Duel with Registration</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
  body { font-family: Arial, sans-serif; display:flex; justify-content:center; align-items:center; min-height:100vh; background:#f0f4f8; margin:0; }
  .card { background:white; padding:20px 25px; border-radius:12px; box-shadow:0 6px 15px rgba(0,0,0,0.1); width:400px; max-width:95%; text-align:center; }
  h1 { margin-top:0; font-size:20px; }
  .digit-row { display:flex; gap:6px; justify-content:center; margin-top:8px; }
  input[type="text"], input[type="password"] { width:60%; height:35px; font-size:16px; margin-top:8px; text-align:left; padding-left:8px; }
  input.digit { width:40px; height:45px; font-size:18px; text-align:center; }
  button { margin-top:12px; padding:10px 15px; font-size:14px; border:none; border-radius:8px; background:#4f46e5; color:white; cursor:pointer; }
  .result { margin-top:15px; padding:10px; background:#eef2ff; border-radius:8px; font-weight:600; }
  .match { display:inline-block; padding:6px 10px; margin:3px; border-radius:8px; font-weight:700; }
  .hit { background:#fee2e2; color:#911; }
  .ok { background:#ecfdf5; color:#065f46; }
  .error { color:#b91c1c; margin-top:8px; font-size:13px; }
  .scoreboard { margin-top:10px; font-size:14px; font-weight:600; }
  .player-label { margin-top:8px; font-weight:600; }
  .tab { cursor:pointer; display:inline-block; padding:6px 12px; margin:4px; border-radius:6px; background:#ddd; }
  .active-tab { background:#4f46e5; color:white; }
</style>
</head>
<body>

<div class="card">

  <!-- Registration/Login Tabs -->
  <div id="authStage">
    <div>
      <span id="loginTab" class="tab active-tab">Login</span>
      <span id="registerTab" class="tab">Register</span>
    </div>

    <div id="loginForm">
      <input type="text" id="loginUsername" placeholder="Username"><br>
      <input type="password" id="loginPassword" placeholder="Password"><br>
      <button id="loginBtn">Login</button>
      <div id="loginError" class="error"></div>
    </div>

    <div id="registerForm" style="display:none;">
      <input type="text" id="regUsername" placeholder="New Username"><br>
      <input type="password" id="regPassword" placeholder="Password"><br>
      <button id="registerBtn">Register</button>
      <div id="registerError" class="error"></div>
    </div>
  </div>

  <!-- Game Stage -->
  <div id="player1Stage" style="display:none;">
    <label id="p1Label"></label>
    <div class="digit-row" id="p1Digits">
      <input class="digit" maxlength="1" type="text">
      <input class="digit" maxlength="1" type="text">
      <input class="digit" maxlength="1" type="text">
      <input class="digit" maxlength="1" type="text">
      <input class="digit" maxlength="1" type="text">
      <input class="digit" maxlength="1" type="text">
    </div>
    <button id="p1Submit">Submit</button>
    <div id="error1" class="error"></div>
  </div>

  <div id="player2Stage" style="display:none;">
    <label id="p2Label"></label>
    <div class="digit-row" id="p2Digits">
      <input class="digit" maxlength="1" type="text">
      <input class="digit" maxlength="1" type="text">
      <input class="digit" maxlength="1" type="text">
      <input class="digit" maxlength="1" type="text">
      <input class="digit" maxlength="1" type="text">
      <input class="digit" maxlength="1" type="text">
    </div>
    <button id="p2Submit">Submit</button>
    <div id="error2" class="error"></div>
  </div>

  <!-- Result Stage -->
  <div id="resultStage" style="display:none;">
    <div id="summary" class="result"></div>

    <div class="player-label" id="player1ResultLabel"></div>
    <div id="player1Result" class="digit-row"></div>

    <div class="player-label" id="player2ResultLabel"></div>
    <div id="player2Result" class="digit-row"></div>

    <div class="scoreboard" id="scoreboard"></div>
    <button id="resetBtn">New Round</button>
  </div>

</div>

<script>
  // Tabs
  const loginTab = document.getElementById('loginTab');
  const registerTab = document.getElementById('registerTab');
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');

  loginTab.onclick = () => { loginForm.style.display='block'; registerForm.style.display='none'; loginTab.classList.add('active-tab'); registerTab.classList.remove('active-tab'); };
  registerTab.onclick = () => { loginForm.style.display='none'; registerForm.style.display='block'; loginTab.classList.remove('active-tab'); registerTab.classList.add('active-tab'); };

  // Auth
  const loginUsername = document.getElementById('loginUsername');
  const loginPassword = document.getElementById('loginPassword');
  const loginBtn = document.getElementById('loginBtn');
  const loginError = document.getElementById('loginError');

  const regUsername = document.getElementById('regUsername');
  const regPassword = document.getElementById('regPassword');
  const registerBtn = document.getElementById('registerBtn');
  const registerError = document.getElementById('registerError');

  let player1Name = '', player2Name = '';

  function getUsers() { return JSON.parse(localStorage.getItem('players')||'{}'); }
  function saveUsers(users) { localStorage.setItem('players', JSON.stringify(users)); }

  registerBtn.onclick = () => {
    const u = regUsername.value.trim(), p = regPassword.value.trim();
    if(!u||!p){ registerError.innerText='Enter username and password.'; return; }
    let users=getUsers();
    if(users[u]){ registerError.innerText='Username exists!'; return; }
    users[u]={password:p,totalScore:0};
    saveUsers(users);
    registerError.style.color='green';
    registerError.innerText='Registered! You can login now.';
  };

  loginBtn.onclick = () => {
    const u = loginUsername.value.trim(), p = loginPassword.value.trim();
    if(!u||!p){ loginError.innerText='Enter username and password.'; return; }
    let users=getUsers();
    if(!users[u] || users[u].password!==p){ loginError.innerText='Invalid username or password.'; return; }
    loginError.innerText='';
    player1Name=u;
    // For demo, assign second player automatically if another exists
    let names=Object.keys(users).filter(x=>x!==u);
    if(names.length>0) player2Name=names[0]; else player2Name='Player2';
    startGame();
  };

  // Game Elements
  const player1Stage = document.getElementById('player1Stage');
  const player2Stage = document.getElementById('player2Stage');
  const resultStage = document.getElementById('resultStage');
  const p1Label = document.getElementById('p1Label');
  const p2Label = document.getElementById('p2Label');
  const player1ResultLabel = document.getElementById('player1ResultLabel');
  const player2ResultLabel = document.getElementById('player2ResultLabel');
  const p1Inputs = Array.from(document.querySelectorAll('#p1Digits input'));
  const p2Inputs = Array.from(document.querySelectorAll('#p2Digits input'));
  const p1Submit = document.getElementById('p1Submit');
  const p2Submit = document.getElementById('p2Submit');
  const error1 = document.getElementById('error1');
  const error2 = document.getElementById('error2');
  const summary = document.getElementById('summary');
  const player1Result = document.getElementById('player1Result');
  const player2Result = document.getElementById('player2Result');
  const scoreboard = document.getElementById('scoreboard');
  const resetBtn = document.getElementById('resetBtn');

  let p1Digits = '';

  function setupAutoFocus(inputs){
    inputs.forEach((input,i)=>{
      input.addEventListener('input',()=>{ input.value=input.value.replace(/[^0-6]/g,''); if(input.value&&i<inputs.length-1) inputs[i+1].focus(); });
      input.addEventListener('keydown',(e)=>{ if(e.key==='Backspace'&&!input.value&&i>0) inputs[i-1].focus(); });
    });
  }
  setupAutoFocus(p1Inputs);
  setupAutoFocus(p2Inputs);

  function startGame(){
    document.getElementById('authStage').style.display='none';
    p1Label.innerText=`${player1Name} — Enter 6 digits (0–6)`;
    p2Label.innerText=`${player2Name} — Enter 6 digits (0–6)`;
    player1ResultLabel.innerText=`${player1Name} Digits:`;
    player2ResultLabel.innerText=`${player2Name} Digits:`;
    player1Stage.style.display='block';
    p1Inputs[0].focus();
  }

  function isValidInputArray(inputs){ return inputs.every(input=>/^[0-6]$/.test(input.value)); }
  function getInputString(inputs){ return inputs.map(input=>input.value).join(''); }
  function sumDigitsBeforeMatch(p1,p2){ let sum=0; for(let i=0;i<6;i++){ if(p1[i]===p2[i]) break; sum+=Number(p1[i]); } return sum; }

  p1Submit.addEventListener('click',()=>{
    if(!isValidInputArray(p1Inputs)){ error1.innerText='Enter exactly 6 digits (0–6).'; return; }
    error1.innerText='';
    p1Digits=getInputString(p1Inputs);
    player1Stage.style.display='none';
    player2Stage.style.display='block';
    p2Inputs.forEach(i=>i.value='');
    p2Inputs[0].focus();
  });

  p2Submit.addEventListener('click',()=>{
    if(!isValidInputArray(p2Inputs)){ error2.innerText='Enter exactly 6 digits (0–6).'; return; }
    error2.innerText='';
    player2Stage.style.display='none';
    const p2Digits=getInputString(p2Inputs);
    showResult(p1Digits,p2Digits);
  });

  function showResult(p1,p2){
    resultStage.style.display='block';
    player1Result.innerHTML='';
    player2Result.innerHTML='';
    let hits=[];
    for(let i=0;i<6;i++){ if(p1[i]===p2[i]) hits.push({pos:i,digit:p1[i]}); }
    const roundScore=sumDigitsBeforeMatch(p1,p2);
    // Update total score in localStorage
    let users=getUsers();
    if(users[player1Name]){ users[player1Name].totalScore+=(roundScore); saveUsers(users); }
    summary.innerText=hits.length>0? `${player1Name} is OUT! Round score: ${roundScore}`:`${player1Name} is SAFE! Round score: ${roundScore}`;

    for(let i=0;i<6;i++){
      const span1=document.createElement('span');
      span1.className='match '+(hits.some(h=>h.pos===i)?'hit':'ok'); span1.innerText=p1[i]; player1Result.appendChild(span1);
      const span2=document.createElement('span');
      span2.className='match '+(hits.some(h=>h.pos===i)?'hit':'ok'); span2.innerText=p2[i]; player2Result.appendChild(span2);
    }

    scoreboard.innerText=`${player1Name} total score: ${users[player1Name].totalScore}`;
  }

  resetBtn.addEventListener('click',()=>{
    p1Inputs.forEach(i=>i.value=''); p2Inputs.forEach(i=>i.value=''); p1Digits='';
    player1Stage.style.display='block'; player2Stage.style.display='none';
    resultStage.style.display='none'; error1.innerText=''; error2.innerText='';
    p1Inputs[0].focus();
  });
</script>

</body>
</html>
